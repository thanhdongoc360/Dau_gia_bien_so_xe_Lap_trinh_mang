Cáº­p Nháº­t ThÃ´ng Tin CÃ¡ NhÃ¢n - Chi Tiáº¿t Äáº§y Äá»§

=== 1. Tá»•ng Quan Chá»©c NÄƒng ===

Má»¥c Ä‘Ã­ch: User cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n sau khi Ä‘Äƒng kÃ½

Há»‡ thá»‘ng há»— trá»£ 2 chá»©c nÄƒng:
1. CHANGE_PASS - Äá»•i máº­t kháº©u
2. CHANGE_NAME - Äá»•i tÃªn hiá»ƒn thá»‹ (display_name)

Dá»¯ liá»‡u User trong users.txt:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
username password role display_name online

VÃ­ dá»¥:
user1 123456 user USER01 0
admin 123456 admin admin 0

Quy trÃ¬nh chung:

                        Client (user)
                              â”‚
                    "CHANGE_PASS/CHANGE_NAME ..."
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Handler kiá»ƒm tra:    â”‚
                    â”‚ - Login?             â”‚
                    â”‚ - Parse parameters?  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ change_password() /  â”‚
                    â”‚ change_display_name()â”‚
                    â”‚ - Lock mutex         â”‚
                    â”‚ - TÃ¬m user           â”‚
                    â”‚ - Validate           â”‚
                    â”‚ - Cáº­p nháº­t           â”‚
                    â”‚ - save_users()       â”‚
                    â”‚ - Unlock mutex       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    send(OK / FAIL)

DÆ°á»›i Ä‘Ã¢y lÃ  **báº£n giáº£i thÃ­ch Ä‘Ã£ Ä‘Æ°á»£c â€œchuáº©n hoÃ¡ â€“ rÃºt gá»n â€“ cÃ³ thá»ƒ dÃ¹ng trá»±c tiáº¿p cho bÃ¡o cÃ¡o / váº¥n Ä‘Ã¡pâ€** cho **Cáº­p Nháº­t ThÃ´ng Tin CÃ¡ NhÃ¢n**, dá»±a **100% Ä‘Ãºng ná»™i dung báº¡n Ä‘Æ°a**, khÃ´ng thÃªm giáº£ Ä‘á»‹nh, khÃ´ng sá»­a logic.

MÃ¬nh **khÃ´ng chÃ©p láº¡i code**, mÃ  táº­p trung **giáº£i thÃ­ch báº£n cháº¥t há»‡ thá»‘ng + luá»“ng + Ã½ nghÄ©a thiáº¿t káº¿**.

---

# Cáº¬P NHáº¬T THÃ”NG TIN CÃ NHÃ‚N (USER PROFILE UPDATE)

---

## 1. Tá»•ng quan chá»©c nÄƒng

### Má»¥c Ä‘Ã­ch

* Cho phÃ©p **user Ä‘Ã£ Ä‘Äƒng nháº­p** cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n **sau khi Ä‘Äƒng kÃ½**
* KhÃ´ng áº£nh hÆ°á»Ÿng tá»›i user khÃ¡c
* Dá»¯ liá»‡u Ä‘Æ°á»£c **lÆ°u bá»n vá»¯ng** (persist qua restart server)

---

### Hai chá»©c nÄƒng Ä‘Æ°á»£c há»— trá»£

1. **CHANGE_PASS** â€“ Äá»•i máº­t kháº©u
2. **CHANGE_NAME** â€“ Äá»•i tÃªn hiá»ƒn thá»‹ (display_name)

---

### Dá»¯ liá»‡u user trong há»‡ thá»‘ng

```
username password role display_name online
```

* `username`: Ä‘á»‹nh danh duy nháº¥t, **khÃ´ng Ä‘á»•i**
* `password`: cÃ³ thá»ƒ Ä‘á»•i
* `display_name`: cÃ³ thá»ƒ Ä‘á»•i
* `role`: admin / user
* `online`: tráº¡ng thÃ¡i Ä‘Äƒng nháº­p

---

## 2. Luá»“ng xá»­ lÃ½ chung (chuáº©n backend)

```
Client â†’ Handler
       â†’ Kiá»ƒm tra login
       â†’ Parse tham sá»‘
       â†’ Gá»i hÃ m xá»­ lÃ½ users
       â†’ Lock mutex
       â†’ Validate & update
       â†’ save_users()
       â†’ Unlock mutex
       â†’ Ghi log
       â†’ Tráº£ káº¿t quáº£
```

ğŸ‘‰ ÄÃ¢y lÃ  **CRUD chuáº©n server-side**, khÃ´ng pháº£i xá»­ lÃ½ táº¡m

---

## 3. CHANGE_PASS â€“ Äá»•i máº­t kháº©u

### 3.1 Äiá»u kiá»‡n báº¯t buá»™c

* User **pháº£i login**
* Pháº£i cung cáº¥p **old password Ä‘Ãºng**
* Format lá»‡nh há»£p lá»‡

---

### 3.2 Ã nghÄ©a tá»«ng bÆ°á»›c xá»­ lÃ½

1. **Kiá»ƒm tra login**

   * NgÄƒn user chÆ°a xÃ¡c thá»±c Ä‘á»•i máº­t kháº©u

2. **Parse old password & new password**

   * Giá»›i háº¡n Ä‘á»™ dÃ i â†’ chá»‘ng buffer overflow
   * Thiáº¿u tham sá»‘ â†’ BAD_FORMAT

3. **Lock `users_mutex`**

   * NgÄƒn race condition khi nhiá»u thread sá»­a users[]

4. **XÃ¡c thá»±c old password**

   * Äáº£m báº£o chá»‰ **chá»§ tÃ i khoáº£n** má»›i Ä‘á»•i Ä‘Æ°á»£c máº­t kháº©u
   * ÄÃ¢y lÃ  Ä‘iá»ƒm **security quan trá»ng nháº¥t**

5. **Cáº­p nháº­t password trong memory**

   * Ghi Ä‘Ã¨ trá»±c tiáº¿p vÃ o `users[i].password`

6. **save_users()**

   * Ghi toÃ n bá»™ users[] ra file `users.txt`
   * Äáº£m báº£o **persistence**

7. **Ghi log**

   * Phá»¥c vá»¥ audit & debug

---

### 3.3 Báº£n cháº¥t báº£o máº­t cá»§a CHANGE_PASS

* KhÃ´ng cho Ä‘á»•i máº­t kháº©u náº¿u **khÃ´ng biáº¿t máº­t kháº©u cÅ©**
* KhÃ´ng cáº§n admin
* KhÃ´ng áº£nh hÆ°á»Ÿng session hiá»‡n táº¡i

ğŸ‘‰ ÄÃ¢y lÃ  **self-service security action**

---

## 4. CHANGE_NAME â€“ Äá»•i tÃªn hiá»ƒn thá»‹

### 4.1 Äiá»u kiá»‡n

* Chá»‰ cáº§n **Ä‘Ã£ login**
* KhÃ´ng cáº§n password cÅ©

---

### 4.2 Ã nghÄ©a thiáº¿t káº¿

1. **TÃªn hiá»ƒn thá»‹ khÃ´ng pháº£i Ä‘á»‹nh danh**

   * Cho phÃ©p Ä‘á»•i linh hoáº¡t
   * KhÃ´ng áº£nh hÆ°á»Ÿng quyá»n háº¡n hay dá»¯ liá»‡u

2. **KhÃ´ng cáº§n validate phá»©c táº¡p**

   * KhÃ´ng kiá»ƒm tra trÃ¹ng
   * KhÃ´ng cáº§n xÃ¡c thá»±c máº¡nh nhÆ° password

3. **Lock mutex + save_users()**

   * Äáº£m báº£o nháº¥t quÃ¡n dá»¯ liá»‡u
   * KhÃ´ng ghi file chá»“ng chÃ©o

4. **Ghi log**

   * CÃ³ thá»ƒ audit thay Ä‘á»•i profile

---

### 4.3 Báº£n cháº¥t cá»§a CHANGE_NAME

* Chá»‰ lÃ  **UI / presentation-level data**
* KhÃ´ng áº£nh hÆ°á»Ÿng báº£o máº­t
* KhÃ´ng áº£nh hÆ°á»Ÿng há»‡ thá»‘ng Ä‘áº¥u giÃ¡

---

## 5. So sÃ¡nh nhanh CHANGE_PASS vs CHANGE_NAME

| TiÃªu chÃ­       | CHANGE_PASS  | CHANGE_NAME  |
| -------------- | ------------ | ------------ |
| Má»©c Ä‘á»™ báº£o máº­t | Cao          | Tháº¥p         |
| Validate       | Old password | KhÃ´ng        |
| áº¢nh hÆ°á»Ÿng      | Security     | UI           |
| Ai lÃ m Ä‘Æ°á»£c    | ChÃ­nh user   | ChÃ­nh user   |
| Field Ä‘á»•i      | password     | display_name |
| Persistence    | CÃ³           | CÃ³           |
| Log            | CÃ³           | CÃ³           |

---

## 6. Mutex & An toÃ n dá»¯ liá»‡u

### VÃ¬ sao báº¯t buá»™c lock mutex?

* users[] lÃ  **shared resource**
* save_users() ghi toÃ n bá»™ file
* Náº¿u khÃ´ng lock â†’ **máº¥t dá»¯ liá»‡u / ghi Ä‘Ã¨**

ğŸ‘‰ ÄÃ¢y lÃ  **Ä‘iá»ƒm thiáº¿t káº¿ backend Ä‘Ãºng chuáº©n**

---

## 7. Persistence â€“ vÃ¬ sao save_users() ráº¥t quan trá»ng?

* Má»i thay Ä‘á»•i:

  * password
  * display_name
* Äá»u Ä‘Æ°á»£c ghi ngay vÃ o file

â¡ Server restart **khÃ´ng máº¥t dá»¯ liá»‡u**

---

## 8. CÃ¡c lá»—i Ä‘Æ°á»£c xá»­ lÃ½ rÃµ rÃ ng

### CHANGE_PASS

* NEED_LOGIN
* BAD_FORMAT
* CHANGE_PASS_FAIL (old password sai)

### CHANGE_NAME

* NEED_LOGIN
* BAD_FORMAT
* CHANGE_NAME_FAIL (hiáº¿m, lÃ½ thuyáº¿t)

ğŸ‘‰ Protocol rÃµ rÃ ng, client dá»… xá»­ lÃ½

---

## 9. Ã nghÄ©a tÃ­ch há»£p há»‡ thá»‘ng

Sau khi cáº­p nháº­t:

* Password má»›i cÃ³ hiá»‡u lá»±c ngay
* Display name má»›i hiá»ƒn thá»‹ trong:

  * Broadcast
  * HISTORY
  * ThÃ´ng bÃ¡o Ä‘áº¥u giÃ¡
* Session **khÃ´ng bá»‹ reset**

---

## 10. Nháº­n xÃ©t thiáº¿t káº¿ (ráº¥t quan trá»ng khi váº¥n Ä‘Ã¡p)

### Äiá»ƒm tá»‘t

* Luá»“ng rÃµ rÃ ng
* CÃ³ mutex
* CÃ³ persistence
* CÃ³ log
* PhÃ¢n biá»‡t rÃµ security-level vs UI-level update

### Háº¡n cháº¿ (Ä‘Ãºng má»©c Ä‘á»“ Ã¡n)

* Password plain text
* KhÃ´ng rate limit
* KhÃ´ng hash

ğŸ‘‰ Vá»›i **Ä‘á»“ Ã¡n C / socket / multi-thread**:
**Thiáº¿t káº¿ nÃ y lÃ  há»£p lÃ½ vÃ  cÃ³ tÆ° duy há»‡ thá»‘ng**

---

## 11. Káº¿t luáº­n 1 cÃ¢u (Ä‘inh)

> **CHANGE_PASS vÃ  CHANGE_NAME lÃ  hai chá»©c nÄƒng self-service chuáº©n backend**,
> Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘Ãºng nguyÃªn táº¯c:
> **authentication â†’ validation â†’ concurrency control â†’ persistence â†’ audit**

Náº¿u báº¡n muá»‘n, mÃ¬nh cÃ³ thá»ƒ:

* Viáº¿t **phiÃªn báº£n â€œtráº£ lá»i miá»‡ng 2 phÃºt cho tháº§yâ€**
* RÃºt gá»n thÃ nh **2 slide trÃ¬nh bÃ y**
* Hoáº·c **so sÃ¡nh vá»›i há»‡ thá»‘ng user profile thá»±c táº¿ (web / REST)**
